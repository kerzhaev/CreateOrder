# Инструкция по настройке системы надбавок без периодов

**Версия:** 1.0.0  
**Дата:** 01.12.2025  
**Автор:** Кержаев Евгений, ФКУ "95 ФЭС" МО РФ

## 1. Создание листов Excel

### 1.1. Лист "Выплаты_Без_Периодов"

Создайте новый лист с именем **"Выплаты_Без_Периодов"** и заполните заголовки в первой строке:

| A | B | C | D | E | F |
|---|---|---|---|---|---|
| № | Тип выплаты | ФИО | Личный номер | Размер выплаты | Основание |

**Пример заполнения:**
| № | Тип выплаты | ФИО | Личный номер | Размер выплаты | Основание |
|---|---|---|---|---|---|
| 1 | Водители СдЕ | Иванов Иван Иванович | 12345 | 5000 | Копия ВУ категории СдЕ, справка ВАИ от 01.01.2025, марка: ГАЗ-3309, ГРЗ: А123БВ45 |

### 1.2. Лист "Справочник_ВУС_Экипаж"

Создайте новый лист с именем **"Справочник_ВУС_Экипаж"** и заполните заголовки:

| A | B | C |
|---|---|---|
| ВУС | Должность | Примечание |

**Пример заполнения:**
| ВУС | Должность | Примечание |
|---|---|---|
| 123456 | командир танка | |
| 234567 | механик-водитель танка | |
| 345678 | наводчик-оператор | |

### 1.3. Лист "Справочник_Типы_Выплат"

Создайте новый лист с именем **"Справочник_Типы_Выплат"** и заполните заголовки:

| A | B | C | D |
|---|---|---|---|
| Тип выплаты | Код | Шаблон Word | Описание |

**Начальные данные (обязательно заполнить):**
| Тип выплаты | Код | Шаблон Word | Описание |
|---|---|---|---|
| Водители СдЕ | DRIVER_SDE | Шаблон_Водители.docx | Надбавка водителям категории СдЕ |
| Экипаж | CREW | Шаблон_Экипаж.docx | Надбавка за экипаж |
| ФИЗО | FIZO | Шаблон_ФИЗО.docx | Надбавка за уровень ФИЗО |
| Секретность | SECRECY | Шаблон_Секретность.docx | Надбавка за секретность |

**Примечание:** Если шаблон для типа выплаты отсутствует, будет использован единый шаблон "Шаблон_Универсальный.docx". Если и он отсутствует, текст приказа будет сформирован напрямую в Word.

---

## 2. Обновление пользовательской ленты (XML)

XML пользовательской ленты находится в самом Excel файле. Для его обновления:

1. Откройте Excel файл
2. Переименуйте расширение файла с `.xlsm` на `.zip`
3. Откройте архив и перейдите в папку `customUI/`
4. Найдите файл `customUI.xml` (или создайте его, если отсутствует)
5. Замените содержимое файла на XML код ниже
6. Сохраните архив и переименуйте обратно в `.xlsm`

### XML код для обновления ленты:

```xml
<!--
Обновленный Custom Ribbon XML для системы управления военным персоналом
Версия: 3.0.0
Дата: 01.12.2025
Описание: Добавлена группа для работы с надбавками без периодов
-->

<customUI xmlns="http://schemas.microsoft.com/office/2009/07/customui">
  <ribbon>
    <tabs>
      <tab id="customTab" label="СВО Макросы">
        
        <!-- Группа экспорта документов -->
        <group id="exportGroup" label="Экспорт документов">
          <button id="mainExport" 
                  label="Основной приказ" 
                  onAction="RunMainExport" 
                  imageMso="FileNew"
                  size="large"
                  screentip="Создание приказа"
                  supertip="Создает Word документ с приказом в дательном падеже на основе данных из листа ДСО"/>
          
          <button id="spravkaExport" 
                  label="Справка ДСО" 
                  onAction="RunSpravkaExport" 
                  imageMso="FileProperties"
                  size="large"
                  screentip="Создание справки ДСО"
                  supertip="Создает справки о нахождении в зоне СВО на основе шаблона Word"/>
          
          <button id="raportExport" 
                  label="Рапорт" 
                  onAction="RunRaportExport" 
                  imageMso="FileDocumentAsTemplate"
                  size="large"
                  screentip="Создание рапорта"
                  supertip="Создает рапорты о выплате компенсации"/>
        </group>
        
        <!-- Группа: Надбавка за риск (выплаты с периодами) -->
        <group id="riskGroup" label="Надбавка за риск">
          <button id="riskOrder" 
                  label="ПриказЗаРиск" 
                  onAction="OnRiskOrderClick" 
                  imageMso="DataFormShowMore"
                  size="large"
                  screentip="Приказ о надбавке за риск"
                  supertip="Создает приказ о выплате надбавки за задачи, связанные с риском для жизни и здоровья (2% в день, макс 60% в месяц)"/>
        </group>
        
        <!-- НОВАЯ ГРУППА: Надбавки без периодов -->
        <group id="allowancesGroup" label="Надбавки">
          <button id="exportAllowances" 
                  label="Экспорт надбавок" 
                  onAction="OnExportAllowancesClick" 
                  imageMso="ExportSharePointList"
                  size="large"
                  screentip="Экспорт надбавок"
                  supertip="Создает приказы на выплату надбавок (водители СдЕ, экипаж, ФИЗО, секретность и др.)"/>
          
          <button id="validateAllowances" 
                  label="Проверить надбавки" 
                  onAction="OnValidateAllowancesClick" 
                  imageMso="ReviewCheckDocument"
                  size="normal"
                  screentip="Валидация надбавок"
                  supertip="Проверяет корректность данных в листе 'Выплаты_Без_Периодов'"/>
          
          <button id="manageReferences" 
                  label="Справочники" 
                  onAction="OnManageReferencesClick" 
                  imageMso="DatabaseTable"
                  size="normal"
                  screentip="Управление справочниками"
                  supertip="Открывает лист 'Справочники' для настройки ВУС, должностей и других справочных данных"/>
        </group>
        
        <!-- Группа отчетов -->
        <group id="reportsGroup" label="Отчеты">
          <button id="excelReport" 
                  label="Отчет по периодам" 
                  onAction="OnPeriodsReportClick" 
                  imageMso="ExportExcel"
                  size="large"
                  screentip="Excel отчет"
                  supertip="Создает Excel файл для передачи в ФЭС (ДСО или ЗаРиск - выбор при запуске)"/>
        </group>
        
        <!-- Группа управления данными -->
        <group id="dataGroup" label="Данные">
          <button id="importData" 
                  label="Импорт данных" 
                  onAction="RunImportData" 
                  imageMso="ImportExcel"
                  size="normal"
                  screentip="Импорт данных"
                  supertip="Импортирует данные из Excel в лист 'Штат'"/>
          
          <button id="previewData" 
                  label="Предпросмотр" 
                  onAction="RunPreviewData" 
                  imageMso="PrintPreview"
                  size="normal"
                  screentip="Предварительный просмотр"
                  supertip="Показывает предварительный просмотр данных"/>
        </group>
        
        <!-- Группа валидации данных -->
        <group id="validationGroup" label="Валидация">
          <button id="validateData" 
                  label="Проверить данные" 
                  onAction="RunDataValidation" 
                  imageMso="ReviewCheckDocument"
                  size="normal"
                  screentip="Валидация данных"
                  supertip="Выполняет полную валидацию данных в листах с выплатами"/>
          
          <button id="diagnoseStructure" 
                  label="Диагностика структуры" 
                  onAction="RunDiagnoseStructure" 
                  imageMso="DatabaseAnalyzeTable"
                  size="normal"
                  screentip="Диагностика структуры"
                  supertip="Анализирует структуру листов и выявляет проблемы"/>
        </group>
        
        <!-- Группа системных функций -->
        <group id="systemGroup" label="Система">
          <button id="showHelp" 
                  label="Справка" 
                  onAction="ShowHelp" 
                  imageMso="Help"
                  size="normal"
                  screentip="Справка по системе"
                  supertip="Показывает подробную справку по использованию программы"/>
          
          <button id="showSettings" 
                  label="Настройки" 
                  onAction="ShowSettings" 
                  imageMso="ApplicationOptionsDialog"
                  size="normal"
                  screentip="Настройки системы"
                  supertip="Показывает текущие настройки и проверяет готовность системы"/>
          
          <button id="checkReadiness" 
                  label="Проверка готовности" 
                  onAction="CheckSystemReadiness" 
                  imageMso="ReviewCheckDocument"
                  size="normal"
                  screentip="Проверка готовности"
                  supertip="Выполняет комплексную проверку готовности системы к работе"/>
        </group>
        
      </tab>
    </tabs>
  </ribbon>
</customUI>
```

---

## 3. Создание шаблонов Word (опционально)

### 3.1. Шаблоны для типов выплат

Создайте шаблоны Word в папке с Excel файлом:

- `Шаблон_Водители.docx` - для надбавки водителям СдЕ
- `Шаблон_Экипаж.docx` - для надбавки за экипаж
- `Шаблон_ФИЗО.docx` - для надбавки за ФИЗО
- `Шаблон_Секретность.docx` - для надбавки за секретность

### 3.2. Единый универсальный шаблон

Создайте шаблон `Шаблон_Универсальный.docx` - он будет использоваться, если шаблон для конкретного типа выплаты отсутствует.

### 3.3. Плейсхолдеры в шаблонах

В шаблонах Word используйте следующие плейсхолдеры:

- `[ФИО]` - ФИО военнослужащего
- `[ФИО_ИМЕНИТЕЛЬНЫЙ]` - ФИО в именительном падеже (склоненное)
- `[ЗВАНИЕ]` - воинское звание
- `[ЗВАНИЕ_СКЛОНЕННОЕ]` - звание в дательном падеже
- `[ЛИЧНЫЙ_НОМЕР]` - личный номер военнослужащего
- `[ДОЛЖНОСТЬ]` - должность
- `[ДОЛЖНОСТЬ_СКЛОНЕННАЯ]` - должность в дательном падеже
- `[РАЗМЕР]` - размер выплаты
- `[ОСНОВАНИЕ]` - основание выплаты

**Пример текста в шаблоне:**
```
[ЗВАНИЕ_СКЛОНЕННОЕ] [ФИО_ИМЕНИТЕЛЬНЫЙ], личный номер [ЛИЧНЫЙ_НОМЕР], [ДОЛЖНОСТЬ_СКЛОНЕННАЯ]
Размер: [РАЗМЕР]
Основание: [ОСНОВАНИЕ]
```

---

## 4. Проверка готовности системы

После настройки всех листов и обновления XML ленты:

1. Откройте Excel файл
2. Нажмите кнопку "Проверка готовности" в группе "Система"
3. Убедитесь, что все компоненты найдены

---

## 5. Использование системы

### 5.1. Заполнение данных о надбавках

1. Откройте лист "Выплаты_Без_Периодов"
2. Заполните данные о надбавках:
   - **Тип выплаты** - выберите из справочника или введите вручную
   - **ФИО** - фамилия, имя, отчество (можно оставить пустым, возьмется из "Штат")
   - **Личный номер** - обязательное поле
   - **Размер выплаты** - размер надбавки
   - **Основание** - полный текст основания с перечислением документов

### 5.2. Валидация данных

1. Нажмите кнопку "Проверить надбавки" в группе "Надбавки"
2. Система проверит корректность данных для каждого типа выплаты
3. Просмотрите отчет о валидации

### 5.3. Экспорт приказов

1. Нажмите кнопку "Экспорт надбавок" в группе "Надбавки"
2. Система создаст приказы Word для каждого типа выплаты
3. Приказы будут сохранены в папке с Excel файлом

---

## 6. Добавление новых типов выплат

Для добавления нового типа выплаты:

1. Откройте лист "Справочник_Типы_Выплат"
2. Добавьте новую строку с данными:
   - **Тип выплаты** - название типа
   - **Код** - уникальный код (например, "NEW_TYPE")
   - **Шаблон Word** - имя файла шаблона (или оставьте пустым для использования универсального)
   - **Описание** - описание типа выплаты
3. При необходимости добавьте функцию валидации в модуль `mdlPaymentValidation.bas`

---

**Готово!** Система готова к использованию.

