# Спецификация: Универсальная система работы с надбавками без периодов

**Версия:** 1.0.0  
**Дата:** 01.12.2025  
**Автор:** Кержаев Евгений, ФКУ "95 ФЭС" МО РФ

## 1. Описание задачи (словами пользователя)

Пользователь хочет дополнить функционал формирования приказов на другие виды выплат, не только сутки отдыха и проценты за риск, но и других выплат, например:
- Выплата водителям категорий СдЕ
- Надбавка за экипаж в боевой и специальной технике
- Надбавка за секретность
- Надбавка за ФИЗО
- И другие массовые выплаты (где выплаты устанавливаются многим военнослужащим)

**Ключевое требование:** При формировании приказа используются те же сведения о военнослужащем (звание, ФИО, личный номер, должность), которые код уже использует при написании готового документа.

**Отличие от выплат с периодами:** В таблице с информацией для формирования приказов не будет содержаться периодов, но будут содержаться необходимые столбцы с информацией, например:
- Документ-основание
- Регистрационный знак машины
- Марка машины
- Справки и ведомости

**Требование универсальности:** Необходимо предусмотреть заполнение в одной или двух вкладках листа Excel этих различных видов выплат, а не плодить вкладки Excel на каждую выплату.

## 2. Текущее состояние системы

### 2.1. Существующие выплаты с периодами
- **ДСО** (Сутки отдыха) - лист "ДСО"
- **Риск** (Проценты за риск) - лист "Риск"

### 2.2. Структура данных военнослужащего
Все данные о военнослужащем берутся из листа "Штат":
- ФИО
- Личный номер
- Воинское звание
- Должность
- Войсковая часть

## 3. Требования к новым типам выплат

### 3.1. Надбавка водителям категории СдЕ
**Условия:**
- Военнослужащий должен иметь категорию СдЕ в водительском удостоверении
- Должность должна быть "водитель" или "старший водитель" (механик-водитель НЕ подходит)
- В основании должны быть указаны:
  - Копия водительского удостоверения
  - Справка с ВАИ об отсутствии нарушений на вверенной технике
  - Марка машины (обычно грузовая)
  - Государственный регистрационный знак (ГРЗ)

**Формат приказа:**
```
[Звание] [ФИО], личный номер [номер], [должность]
Размер: [размер]
Основание: [перечисление документов]
```

### 3.2. Надбавка за экипаж
**Условия:**
- ВУС военнослужащего должен входить в перечень ВУС для экипажа
- Должность военнослужащего должна входить в перечень должностей для экипажа
- Проверка: пара (ВУС, должность) должна быть в справочнике

**Справочник:** Лист "Справочник_ВУС_Экипаж" с колонками:
- ВУС
- Должность

**Формат приказа:**
```
[Звание] [ФИО], личный номер [номер], [должность]
Размер: [размер]
Основание: [ссылка на перечень ВУС и должностей]
```

### 3.3. Надбавка за уровень физической подготовленности (ФИЗО)
**Условия:**
- В основании должно быть минимум две ведомости квартальных проверок
- Ведомости должны быть указаны в формате: "Ведомость от [дата]"

**Формат приказа:**
```
[Звание] [ФИО], личный номер [номер], [должность]
Размер: [размер]
Основание: [перечисление ведомостей]
```

### 3.4. Надбавка за секретность
**Условия:**
- В основании указывается:
  - Форма допуска
  - Номер допуска
  - Дата допуска
  - Пункт номенклатуры

**Формат приказа:**
```
[Звание] [ФИО], личный номер [номер], [должность]
Размер: [размер]
Основание: Форма: [форма], Номер: [номер], Дата: [дата], Пункт номенклатуры: [пункт]
```

### 3.5. Расширяемость системы
Система должна позволять добавлять новые типы надбавок в будущем без изменения основной логики.

## 4. Структура данных

### 4.1. Лист "Выплаты_Без_Периодов"
**Колонки:**
| Колонка | Название | Описание | Обязательность |
|---------|----------|----------|----------------|
| A | № | Порядковый номер | Да |
| B | Тип выплаты | "Водители СдЕ", "Экипаж", "ФИЗО", "Секретность" и т.д. | Да |
| C | ФИО | Фамилия, имя, отчество | Да |
| D | Личный номер | Личный номер военнослужащего | Да |
| E | Размер выплаты | Размер надбавки (заполняется вручную) | Да |
| F | Основание | Полный текст основания с перечислением документов | Да |

**Примечание:** 
- Колонки "Воинское звание" и "Должность" НЕ включаются в таблицу - они подставляются автоматически из листа "Штат" при формировании приказа по личному номеру.
- Размер выплаты заполняется вручную пользователем (протягиванием или копированием значений).

### 4.2. Лист "Справочник_ВУС_Экипаж"
**Колонки:**
| Колонка | Название | Описание |
|---------|----------|----------|
| A | ВУС | ВУС для надбавки за экипаж |
| B | Должность | Должность для надбавки за экипаж |
| C | Примечание | Дополнительная информация (опционально) |

**Логика:** Каждая строка представляет допустимую пару (ВУС, Должность) для надбавки за экипаж.

### 4.3. Лист "Справочник_Типы_Выплат"
**Колонки:**
| Колонка | Название | Описание |
|---------|----------|----------|
| A | Тип выплаты | Название типа (например, "Водители СдЕ") |
| B | Код | Уникальный код типа (например, "DRIVER_SDE") |
| C | Шаблон Word | Имя файла шаблона Word (например, "Шаблон_Водители.docx") |
| D | Описание | Описание типа выплаты |

**Примеры записей:**
- Водители СдЕ | DRIVER_SDE | Шаблон_Водители.docx | Надбавка водителям категории СдЕ
- Экипаж | CREW | Шаблон_Экипаж.docx | Надбавка за экипаж
- ФИЗО | FIZO | Шаблон_ФИЗО.docx | Надбавка за уровень ФИЗО
- Секретность | SECRECY | Шаблон_Секретность.docx | Надбавка за секретность

## 5. Функциональные требования

### 5.1. Валидация данных
- Проверка обязательных полей для каждого типа выплаты
- Проверка корректности данных (например, для водителей СдЕ - проверка должности)
- Проверка наличия данных в справочниках (для экипажа - проверка пары ВУС-должность)
- Проверка формата данных в основании (для ФИЗО - минимум 2 ведомости, для секретности - формат)

### 5.2. Экспорт в Word
- Группировка военнослужащих по типу выплаты
- Генерация приказов Word для каждого типа выплаты
- **Логика выбора шаблона:**
  1. Использование шаблона, указанного в справочнике "Справочник_Типы_Выплат" для данного типа выплаты
  2. Если шаблон для типа выплаты отсутствует - использование единого универсального шаблона (имя задается в настройках)
  3. Если и единый шаблон отсутствует - формирование текста приказа напрямую в Word без шаблона
- Заполнение шаблонов данными о военнослужащих (звание и должность берутся из листа "Штат" по личному номеру)

### 5.3. Интеграция с пользовательской лентой
- Кнопка "Экспорт надбавок" в группе "Надбавки"
- Кнопка "Проверить надбавки" для валидации
- Кнопка "Справочники" для открытия листа со справочниками

### 5.4. Получение данных о военнослужащем
- При формировании приказа звание и должность автоматически подставляются из листа "Штат" по личному номеру
- Данные о военнослужащем не хранятся в листе "Выплаты_Без_Периодов", а всегда берутся из актуального листа "Штат"

## 6. Нефункциональные требования

### 6.1. Производительность
- Экспорт должен работать с большим количеством записей (100+ военнослужащих)
- Валидация должна выполняться быстро

### 6.2. Совместимость
- Поддержка Office 2010 и выше
- Поддержка 32-bit и 64-bit версий Excel

### 6.3. Расширяемость
- Легкое добавление новых типов выплат через справочник
- Модульная архитектура кода

### 6.4. Обработка ошибок
- Все процедуры должны иметь обработку ошибок
- Информативные сообщения об ошибках для пользователя

## 7. Ограничения и допущения

### 7.1. Ограничения
- Лист "Штат" должен содержать актуальные данные о военнослужащих
- Шаблоны Word должны находиться в папке с Excel файлом
- Личный номер должен быть уникальным идентификатором

### 7.2. Допущения
- Пользователь будет корректно заполнять данные в листе "Выплаты_Без_Периодов"
- Справочники будут поддерживаться в актуальном состоянии
- Шаблоны Word будут соответствовать ожидаемому формату
- Размер выплаты заполняется пользователем вручную (протягиванием или копированием)
- Миграция данных из существующих листов "ДСО" и "Риск" не требуется на данном этапе

## 8. Критерии приемки

1. ? Создан лист "Выплаты_Без_Периодов" с корректной структурой
2. ? Созданы справочники "Справочник_ВУС_Экипаж" и "Справочник_Типы_Выплат"
3. ? Реализована валидация для всех типов надбавок
4. ? Реализован экспорт надбавок в Word с использованием шаблонов
5. ? Добавлены кнопки в пользовательскую ленту
6. ? Система позволяет добавлять новые типы выплат через справочник
7. ? Все функции имеют обработку ошибок
8. ? Код соответствует стандартам проекта (Option Explicit, документация, типизация)

## 9. Уточнения (получены от пользователя)

1. ? **Миграция данных:** Пока не требуется
2. ? **Шаблоны Word:** 
   - Для каждой выплаты свой шаблон (указывается в справочнике "Справочник_Типы_Выплат")
   - Если шаблон для типа выплаты отсутствует - используется единый универсальный шаблон
   - Если и единый шаблон отсутствует - формируется текст приказа напрямую в Word
3. ? **Размер выплаты:** Определяется вручную, в таблице протягиваются или копируются значения
4. ? **Колонки звание и должность:** Убраны из таблицы "Выплаты_Без_Периодов" - они подставляются автоматически из листа "Штат" при формировании приказа

---

**Статус:** Утверждена, готова к созданию плана

