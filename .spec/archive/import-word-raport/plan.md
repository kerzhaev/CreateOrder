# План реализации: Импорт рапортов из Word

**Дата:** 22.02.2026
**Основание:** `spec.md` (Импорт утвержденных рапортов)

## 1. Архитектура решения
Мы используем паттерн "Word -> HTML -> Excel (Memory Dict) -> DSO Sheet".
Это изолирует нас от багов объектной модели Word при чтении таблиц.

## 2. Структура изменений

### Фаза 1: UI и Подготовка
1. Изменить `customUI14.xml` — добавить кнопку "Импорт рапорта (Word)" в группу "Данные".
2. Создать новый модуль `mdlWordImport.bas`.

### Фаза 2: Механизм экстракции (Extract)
1. Написать функцию `SelectWordFile` (вызов диалогового окна).
2. Написать функцию `ConvertWordToHTML` (создание скрытого объекта Word.Application, открытие файла, SaveAs(wdFormatFilteredHTML), закрытие).

### Фаза 3: Механизм трансформации (Transform)
1. Написать функцию `ParseHTMLToDictionary`.
   - Открытие HTML-файла в Excel.
   - Поиск колонок "Личный номер", "Дата начало", "Дата окончания".
   - Чтение строк в объект `Scripting.Dictionary`, где `Key` = Личный номер, `Item` = Коллекция периодов (массивов дат).
   - Закрытие и удаление HTML-файла.

### Фаза 4: Механизм загрузки (Load)
1. Написать функцию `LoadPeriodsToDSO`.
   - Перебор ключей из Dictionary.
   - Поиск строки в листе "ДСО" по личному номеру.
   - Если найден: поиск первой пустой пары ячеек в строке (начиная со столбца E) и запись коллекции дат. Хронологическая сортировка.
   - Если не найден: поиск в листе "Штат" (через `mdlHelper.GetStaffData`), создание новой строки в конце листа "ДСО", запись данных.
